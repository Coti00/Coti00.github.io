{{/* 슬라이드 쇼 블록 초기화 */}}
{{ $page := .wcPage }}
{{ $block := .wcBlock }}
{{ $hash_id := $block.id }} <!-- 슬라이드 ID 가져오기 -->
{{ $slide_items := where .Site.Pages "Section" "slider" }} <!-- slider 섹션의 모든 항목 가져오기 -->
{{ $slide_count := len $slide_items }} <!-- 슬라이드 수 계산 -->

<!-- Indicators -->
{{ if gt $slide_count 1 }}
<ol class="carousel-indicators flex justify-center space-x-2 my-4">
  {{ range $index, $item := $slide_items }}
  <li data-target="#{{$hash_id}}" data-slide-to="{{$index}}" class="w-3 h-3 rounded-full cursor-pointer {{if eq $index 0}} bg-gray-800 {{else}} bg-gray-300 {{end}}"></li>
  {{ end }}
</ol>
{{ end }}

<!-- Carousel slides wrapper -->
<div id="{{ $hash_id }}" class="carousel slide relative overflow-hidden" data-ride="carousel" data-interval="3000">
  <div class="carousel-inner relative w-full overflow-hidden">
    {{ range $index, $item := $slide_items }}
    
    <!-- 배경 이미지 및 색상 스타일 설정 -->
    {{ $bg := $item.Params.background }}
    {{ $bg_class := "" }}
    {{ if $bg.color }}
      {{ $bg_class = print "bg-" (replace $bg.color "#" "") }}
    {{ end }}

    {{ if $bg.image.filename }}
      {{ $bg_img := resources.Get (printf "media/%s" $bg.image.filename) }}
      {{ if $bg_img }}
        <!-- 이미지가 있을 경우 Tailwind의 background 설정을 위해 동적으로 스타일 추가 -->
        {{ $bg_class = print "bg-cover bg-center" }}
      {{ else }}
        {{ errorf "Couldn't find `%s` in the `assets/media/` folder - please add it." $bg.image.filename }}
      {{ end }}
    {{ end }}

    <div class="carousel-item {{ if eq $index 0 }} active {{ end }} relative w-full h-96 {{ $bg_class }}">

      <!-- 슬라이드 배경 이미지 설정 (동적으로 class 추가) -->
      {{ if $bg.image.filename }}
        <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('{{ $bg_img.Permalink }}');"></div>
      {{ end }}

      <!-- 필터 클래스 정의 -->
      {{ $filter_class := "" }}
      {{ with $bg.image.filters.brightness }}
        {{ $filter_class = "brightness-" (print (float64 (mul 100 .)) | int) }}
      {{ end }}

      <div class="absolute inset-0 flex justify-center items-center {{ $filter_class }}">
        <div class="wg-hero dark container mx-auto px-6 text-{{ $item.Params.align | default "left" }}">
          <h1 class="hero-title text-white text-4xl font-bold">
            {{ with $item.Title }}{{ . | markdownify | emojify }}{{ end }}
          </h1>

          {{ with $item.Content }}
          <p class="hero-lead text-white text-lg my-4 mx-auto text-{{ $item.Params.align | default "left" }}">
            {{ . | emojify | $page.RenderString }}
          </p>
          {{ end }}

          {{ if $item.Params.link.url }}
            <p>
              <a href="{{ $item.Params.link.url }}" class="btn btn-light btn-lg mt-3 bg-white text-gray-800 hover:bg-gray-200 transition duration-300">
                {{ $item.Params.link.text | emojify | markdownify | safeHTML }}
              </a>
            </p>
          {{ end }}
        </div>
      </div>
    </div>
    {{ end }}
  </div>

  <!-- Left and right controls -->
  {{ if gt $slide_count 1 }}
  <a class="carousel-control-prev absolute top-1/2 transform -translate-y-1/2 left-0 text-gray-800 hover:text-gray-600" href="#{{$hash_id}}" role="button" data-slide="prev">
    <span class="carousel-control-prev-icon inline-block bg-no-repeat"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next absolute top-1/2 transform -translate-y-1/2 right-0 text-gray-800 hover:text-gray-600" href="#{{$hash_id}}" role="button" data-slide="next">
    <span class="carousel-control-next-icon inline-block bg-no-repeat"></span>
    <span class="sr-only">Next</span>
  </a>
  {{ end }}
</div>
